{"version":3,"file":"grid.js","sources":["../../src/zoo-modules/grid-modules/grid-module/grid.js"],"sourcesContent":["/**\n * @injectHTML\n * https://github.com/whatwg/html/issues/6226\n * which leads to https://github.com/WICG/webcomponents/issues/59\n */\nexport class ZooGrid extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t// TODO in v9 remove currentpage and maxpages and use only paginator for that\n\tstatic get observedAttributes() {\n\t\treturn ['currentpage', 'maxpages', 'resizable', 'reorderable'];\n\t}\n\n\tconnectedCallback() {\n\t\tconst root = this.shadowRoot;\n\t\tconst headerSlot = root.querySelector('slot[name=\"headercell\"]');\n\t\theaderSlot.addEventListener('slotchange', this.debounce(() => {\n\t\t\tconst headers = headerSlot.assignedElements();\n\t\t\tthis.style.setProperty('--grid-column-num', headers.length);\n\t\t\theaders.forEach((header, i) => header.setAttribute('column', i+1));\n\t\t\tif (this.hasAttribute('reorderable')) {\n\t\t\t\theaders.forEach(header => this.handleDraggableHeader(header));\n\t\t\t}\n\t\t}));\n\t\tconst rowSlot = root.querySelector('slot[name=\"row\"]');\n\t\trowSlot.addEventListener('slotchange', this.debounce(() => {\n\t\t\trowSlot.assignedElements().forEach(row => [].forEach.call(row.children, (child, i) => child.setAttribute('column', i+1)));\n\t\t}));\n\t\tthis.addEventListener('sortChange', e => this.handleSortChange(e));\n\t}\n\n\tattributeChangedCallback(attrName, oldVal, newVal) {\n\t\tif (attrName == 'resizable' && this.hasAttribute('resizable')) {\n\t\t\tthis.resizeObserver = this.resizeObserver || new ResizeObserver(this.debounce(this.resizeCallback.bind(this)));\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.shadowRoot.querySelector('slot[name=\"headercell\"]').assignedElements().forEach(header => this.resizeObserver.observe(header));\n\t\t}\n\t\tif (attrName == 'reorderable' && this.hasAttribute('reorderable')) {\n\t\t\tconst headers = this.shadowRoot.querySelector('slot[name=\"headercell\"]').assignedElements();\n\t\t\theaders.forEach(header => this.handleDraggableHeader(header));\n\t\t}\n\t\tif (attrName == 'maxpages' || attrName == 'currentpage') {\n\t\t\tconst paginator = this.shadowRoot.querySelector('zoo-paginator');\n\t\t\tif (paginator && !paginator.hasAttribute(attrName)) {\n\t\t\t\tpaginator.setAttribute(attrName, newVal);\n\t\t\t}\n\t\t}\n\t}\n\tresizeCallback(entries) {\n\t\tentries.forEach(entry => {\n\t\t\tconst columnNum = entry.target.getAttribute('column');\n\t\t\tconst width = entry.contentRect.width;\n\t\t\tthis.querySelectorAll(`[column=\"${columnNum}\"]`)\n\t\t\t\t.forEach(columnEl => columnEl.style.width = `${width}px`);\n\t\t});\n\t}\n\n\tdebounce(func, wait) {\n\t\tlet timeout;\n\t\treturn function() {\n\t\t\tconst later = () => {\n\t\t\t\ttimeout = null;\n\t\t\t\tfunc.apply(this, arguments);\n\t\t\t};\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(later, wait);\n\t\t\tif (!timeout) func.apply(this, arguments);\n\t\t};\n\t}\n\n\thandleDraggableHeader(header) {\n\t\t// avoid attaching multiple eventListeners to the same element\n\t\tif (header.hasAttribute('reorderable')) return;\n\t\theader.setAttribute('reorderable', '');\n\t\theader.setAttribute('ondragover', 'event.preventDefault()');\n\t\theader.setAttribute('ondrop', 'event.preventDefault()');\n\n\t\theader.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', header.getAttribute('column')));\n\t\t// drag enter fires before dragleave, so stagger this function\n\t\theader.addEventListener('dragenter', this.debounce(() => header.classList.add('drag-over')));\n\t\theader.addEventListener('dragleave', () => header.classList.remove('drag-over'));\n\t\theader.addEventListener('drop', e => this.handleDrop(e));\n\t}\n\n\thandleDrop(e) {\n\t\tthis.shadowRoot.querySelector('slot[name=\"headercell\"]').assignedElements().forEach(h => h.classList.remove('drag-over'));\n\t\tconst sourceColumn = e.dataTransfer.getData('text');\n\t\tconst targetColumn = e.target.getAttribute('column');\n\t\tif (targetColumn == sourceColumn) return;\n\t\t// move columns\n\t\tthis.querySelectorAll(`[column=\"${sourceColumn}\"]`).forEach(source => {\n\t\t\tconst target = source.parentElement.querySelector(`[column=\"${targetColumn}\"]`);\n\t\t\ttargetColumn > sourceColumn ? target.after(source) : target.before(source);\n\t\t});\n\t\t// reassign indexes for row cells\n\t\tconst allRows = this.shadowRoot.querySelector('slot[name=\"row\"]').assignedElements();\n\t\tallRows.forEach(row => [].forEach.call(row.children, (child, i) => child.setAttribute('column', i+1)));\n\t}\n\n\thandleSortChange(e) {\n\t\tif (this.prevSortedHeader && !e.target.isEqualNode(this.prevSortedHeader)) {\n\t\t\tthis.prevSortedHeader.removeAttribute('sortstate');\n\t\t}\n\t\tthis.prevSortedHeader = e.target;\n\t}\n\n\tdisconnectedCallback() {\n\t\tif (this.resizeObserver) {\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.resizeObserver = null;\n\t\t}\n\t}\n}\n\nwindow.customElements.define('zoo-grid', ZooGrid);"],"names":[],"mappings":"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"}